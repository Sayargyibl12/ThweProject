<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Happy New Year ‚ú®</title>
  <style>
    :root{
      --bg1:#070216;
      --bg2:#0a2a43;
      --glass: rgba(255,255,255,.08);
      --glass2: rgba(255,255,255,.12);
      --stroke: rgba(255,255,255,.18);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.72);
      --accent1:#ff4fd8;
      --accent2:#66f0ff;
      --accent3:#ffd166;
      --shadow: 0 25px 70px rgba(0,0,0,.45);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      overflow-x:hidden;
      background:
        radial-gradient(1200px 700px at 15% 10%, rgba(102,240,255,.18), transparent 55%),
        radial-gradient(1000px 650px at 85% 15%, rgba(255,79,216,.16), transparent 60%),
        radial-gradient(900px 600px at 50% 90%, rgba(255,209,102,.14), transparent 55%),
        linear-gradient(120deg, var(--bg1), var(--bg2));
    }

    /* Animated gradient wash */
    .wash{
      position:fixed; inset:-20%;
      background: conic-gradient(from 180deg,
        rgba(255,79,216,.12),
        rgba(102,240,255,.12),
        rgba(255,209,102,.10),
        rgba(255,79,216,.12)
      );
      filter: blur(60px);
      animation: spin 18s linear infinite;
      opacity:.7;
      pointer-events:none;
      z-index:0;
    }
    @keyframes spin{to{transform:rotate(360deg)}}

    /* Fireworks canvas */
    #fx{
      position:fixed; inset:0;
      z-index:1;
      pointer-events:none;
    }

    /* Main content */
    .page{
      position:relative;
      z-index:2;
      min-height:100%;
      padding: clamp(18px, 3vw, 34px);
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .shell{
      width:min(1100px, 96vw);
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap: clamp(16px, 2.6vw, 28px);
      align-items:stretch;
    }

    @media (max-width: 900px){
      .shell{grid-template-columns:1fr}
    }

    .card{
      background: linear-gradient(180deg, var(--glass), rgba(255,255,255,.04));
      border:1px solid var(--stroke);
      border-radius: 22px;
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
      -webkit-backdrop-filter: blur(10px);
      backdrop-filter: blur(10px);
    }

    .card::before{
      content:"";
      position:absolute; inset:-2px;
      background: radial-gradient(800px 300px at 20% 0%, rgba(102,240,255,.18), transparent 60%),
                  radial-gradient(600px 250px at 90% 10%, rgba(255,79,216,.16), transparent 60%);
      pointer-events:none;
      opacity:.9;
      filter: blur(0px);
    }

    /* Left panel */
    .hero{
      padding: clamp(18px, 2.4vw, 30px);
      display:flex;
      flex-direction:column;
      gap: 16px;
    }

    .badge{
      width:max-content;
      display:flex;
      align-items:center;
      gap:10px;
      padding:10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.18);
      box-shadow: 0 12px 30px rgba(0,0,0,.28);
      font-size: 13px;
      color: var(--muted);
    }
    .dot{
      width:10px; height:10px; border-radius:50%;
      background: radial-gradient(circle, var(--accent2), transparent 60%);
      box-shadow: 0 0 20px rgba(102,240,255,.7);
      position:relative;
    }
    .dot::after{
      content:"";
      position:absolute; inset:-4px;
      border-radius:50%;
      border:1px solid rgba(102,240,255,.4);
      animation:pulse 1.6s ease-in-out infinite;
    }
    @keyframes pulse{
      0%,100%{transform:scale(1); opacity:.55}
      50%{transform:scale(1.55); opacity:.08}
    }

    h1{
      margin:0;
      font-size: clamp(34px, 4.1vw, 58px);
      line-height:1.02;
      letter-spacing:-.02em;
      text-shadow: 0 0 25px rgba(255,79,216,.22), 0 0 30px rgba(102,240,255,.18);
    }

    .shimmer{
      display:inline-block;
      position:relative;
      background: linear-gradient(90deg,
        rgba(255,255,255,.35),
        rgba(255,255,255,.95),
        rgba(255,255,255,.35)
      );
      -webkit-background-clip:text;
      background-clip:text;
      color:transparent;
    }
    .shimmer::after{
      content:"";
      position:absolute; inset:0;
      background: linear-gradient(120deg,
        transparent 0%,
        rgba(255,255,255,.35) 25%,
        transparent 55%
      );
      transform: translateX(-140%);
      animation: sheen 2.6s ease-in-out infinite;
      mix-blend-mode: overlay;
    }
    @keyframes sheen{
      0%{transform:translateX(-140%)}
      55%{transform:translateX(140%)}
      100%{transform:translateX(140%)}
    }

    .sub{
      margin:0;
      color: var(--muted);
      font-size: clamp(14px, 1.6vw, 16px);
      max-width: 62ch;
    }

    .countdown{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
      margin-top: 6px;
    }
    @media (max-width: 520px){
      .countdown{grid-template-columns: repeat(2, 1fr)}
    }

    .tile{
      position:relative;
      padding: 14px 12px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.18);
      overflow:hidden;
      transform: translateZ(0);
    }

    .tile::before{
      content:"";
      position:absolute; inset:-80px;
      background: radial-gradient(circle at 30% 30%, rgba(255,79,216,.22), transparent 45%),
                  radial-gradient(circle at 70% 70%, rgba(102,240,255,.18), transparent 45%);
      filter: blur(0px);
      opacity:.9;
      animation: drift 6s ease-in-out infinite;
    }
    @keyframes drift{
      0%,100%{transform:translate(0,0)}
      50%{transform:translate(18px,-12px)}
    }

    .tile > *{position:relative; z-index:1}
    .num{
      font-size: clamp(28px, 3.1vw, 40px);
      font-weight: 800;
      letter-spacing:-.02em;
    }
    .label{
      margin-top: 2px;
      font-size: 12px;
      letter-spacing: .14em;
      text-transform: uppercase;
      color: rgba(255,255,255,.72);
    }

    .actions{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-top: 8px;
      align-items:center;
    }

    .btn{
      border: 1px solid rgba(255,255,255,.2);
      background: rgba(255,255,255,.08);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 14px;
      cursor:pointer;
      font-weight: 600;
      letter-spacing:.01em;
      transition: transform .15s ease, background .15s ease, border-color .15s ease;
      -webkit-user-select: none;
      user-select:none;
    }
    .btn:hover{transform: translateY(-1px); background: rgba(255,255,255,.12); border-color: rgba(255,255,255,.28)}
    .btn:active{transform: translateY(0px) scale(.98)}

    .hint{
      color: rgba(255,255,255,.7);
      font-size: 13px;
    }

    /* Right panel butterfly + text */
    .side{
      display:flex;
      flex-direction:column;
    }

    .butterflyWrap{
      padding: 18px;
      border-bottom: 1px solid rgba(255,255,255,.12);
      position:relative;
      overflow:hidden;
    }

    .butterflyWrap::after{
      content:"";
      position:absolute; inset:-60px;
      background: radial-gradient(circle at 20% 10%, rgba(255,209,102,.16), transparent 55%),
                  radial-gradient(circle at 80% 20%, rgba(255,79,216,.14), transparent 55%);
      transform: rotate(10deg);
      opacity:.85;
      pointer-events:none;
    }

    .butterfly{
      position:relative;
      height: 320px;
      display:grid;
      place-items:center;
      isolation:isolate;
    }

    .wing{
      position:absolute;
      width: 42%;
      height: 42%;
      border-radius: 22px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.20);
      box-shadow: 0 18px 60px rgba(0,0,0,.35);
      transform-origin: center;
      background: rgba(0,0,0,.12);
    }
    .wing img{
      width:100%;
      height:100%;
      object-fit:cover;
      filter: saturate(1.08) contrast(1.05);
      transform: scale(1.04);
      transition: transform .6s ease, filter .6s ease;
    }
    .wing:hover img{
      transform: scale(1.12);
      filter: saturate(1.22) contrast(1.12);
    }

    /* butterfly layout (4 photos ‚Äúparallel‚Äù like wings) */
    .w1{ left:6%;  top:10%;  clip-path: polygon(10% 10%, 100% 0, 90% 100%, 0 85%); }
    .w2{ right:6%; top:10%;  clip-path: polygon(0 0, 90% 10%, 100% 85%, 10% 100%); }
    .w3{ left:6%;  bottom:10%; clip-path: polygon(0 15%, 90% 0, 100% 100%, 10% 90%); }
    .w4{ right:6%; bottom:10%; clip-path: polygon(10% 0, 100% 15%, 90% 90%, 0 100%); }

    /* center body */
    .butterBody{
      width: 18px;
      height: 180px;
      border-radius: 999px;
      background: linear-gradient(180deg, rgba(255,255,255,.86), rgba(255,255,255,.14));
      box-shadow: 0 0 28px rgba(102,240,255,.18);
      position:relative;
      z-index:2;
      opacity:.9;
    }
    .butterBody::before, .butterBody::after{
      content:"";
      position:absolute;
      top:-22px;
      width: 2px;
      height: 42px;
      background: rgba(255,255,255,.65);
      border-radius:999px;
    }
    .butterBody::before{ left: 3px; transform: rotate(-18deg); }
    .butterBody::after{ right: 3px; transform: rotate(18deg); }

    /* subtle wing flaps (JS will update CSS vars for parallax too) */
    .wing{
      animation: flap 3.2s ease-in-out infinite;
    }
    .w2{ animation-delay: .12s; }
    .w3{ animation-delay: .18s; }
    .w4{ animation-delay: .28s; }

    @keyframes flap{
      0%,100%{transform: perspective(900px) rotateY(0deg) rotateX(0deg) translateZ(0) }
      50%{transform: perspective(900px) rotateY(var(--ry, 7deg)) rotateX(var(--rx, -4deg)) translateZ(2px)}
    }

    .textWrap{
      padding: 18px 18px 22px;
      display:flex;
      flex-direction:column;
      gap: 10px;
      position:relative;
    }

    .title2{
      margin:0;
      font-size: 18px;
      letter-spacing:.01em;
      display:flex;
      align-items:center;
      gap:10px;
    }
    .spark{
      width:10px; height:10px;
      background: radial-gradient(circle, var(--accent1), transparent 60%);
      border-radius:50%;
      box-shadow: 0 0 24px rgba(255,79,216,.65);
    }

    .para{
      margin:0;
      color: rgba(255,255,255,.80);
      line-height:1.7;
      font-size: 14.5px;
    }

    .quote{
      margin-top: 8px;
      padding: 12px 12px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.14);
      color: rgba(255,255,255,.82);
      font-size: 13px;
      line-height:1.5;
      position:relative;
      overflow:hidden;
    }
    .quote::before{
      content:"";
      position:absolute; inset:-60px;
      background: radial-gradient(circle at 30% 30%, rgba(102,240,255,.16), transparent 50%),
                  radial-gradient(circle at 70% 60%, rgba(255,209,102,.12), transparent 55%);
      opacity:.9;
      pointer-events:none;
    }
    .quote span{position:relative; z-index:1}

    /* Toast at midnight */
    .toast{
      position:fixed;
      left:50%;
      bottom:22px;
      transform: translateX(-50%) translateY(20px);
      padding: 12px 14px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.2);
      background: rgba(0,0,0,.28);
      -webkit-backdrop-filter: blur(10px);
      backdrop-filter: blur(10px);
      box-shadow: 0 20px 60px rgba(0,0,0,.4);
      opacity:0;
      pointer-events:none;
      z-index:5;
      transition: opacity .35s ease, transform .35s ease;
      max-width:min(520px, 92vw);
      text-align:center;
      font-weight: 650;
      letter-spacing:.01em;
    }
    .toast.show{opacity:1; transform: translateX(-50%) translateY(0)}

    /* small footer */
    .foot{
      margin-top: 8px;
      color: rgba(255,255,255,.58);
      font-size: 12px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }

    /* Reduce motion accessibility */
    @media (prefers-reduced-motion: reduce){
      .wash, .wing, .tile::before, .dot::after, .shimmer::after { animation:none !important; }
    }
  </style>
</head>
<body>
  <div class="wash" aria-hidden="true"></div>
  <canvas id="fx"></canvas>

  <div class="page">
    <div class="shell">
      <!-- LEFT: Countdown + headline -->
      <section class="card hero" id="hero">
        <div class="badge">
          <span class="dot"></span>
          <span id="statusText">Counting down to the New Year‚Ä¶</span>
        </div>

        <h1>
          <span class="shimmer" id="headline">Happy New Year Thwe Thwe</span> ‚ú®
        </h1>

        <p class="sub" id="subtext">
          Tdy is the last day of the year. May your new year be filled with joy, success, and all the things that make you smile.
        </p>

        <div class="countdown" aria-label="countdown">
          <div class="tile">
            <div class="num" id="d">00</div>
            <div class="label">Days</div>
          </div>
          <div class="tile">
            <div class="num" id="h">00</div>
            <div class="label">Hours</div>
          </div>
          <div class="tile">
            <div class="num" id="m">00</div>
            <div class="label">Minutes</div>
          </div>
          <div class="tile">
            <div class="num" id="s">00</div>
            <div class="label">Seconds</div>
          </div>
        </div>

        <div class="actions">
          <button class="btn" id="burstBtn">üéÜ Firework Burst</button>
          <button class="btn" id="toggleFxBtn">ü™Ñ Toggle Fireworks</button>
          <span class="hint">Tip: click/tap anywhere for fireworks.</span>
        </div>

        <div class="foot">
          <span id="targetText">Target: Jan 1, next year (local time)</span>
          <span>‚Ä¢</span>
          <span id="timeText">‚Äî</span>
        </div>
      </section>

      <!-- RIGHT: Butterfly photos + paragraph -->
      <aside class="card side" id="side">
        <div class="butterflyWrap">
          <div class="butterfly" id="butterfly">
            <!-- Replace these image URLs with your own -->
            <div class="wing w1"><img alt="Photo 1" src="./image/img1.jpg"></div>
            <div class="wing w2"><img alt="Photo 2" src="./image/img4.jpg"></div>
            <div class="wing w3"><img alt="Photo 3" src="./image/img2.jpg"></div>
            <div class="wing w4"><img alt="Photo 4" src="./image/img5.jpg"></div>
            <div class="butterBody" aria-hidden="true"></div>
          </div>
        </div>

        <div class="textWrap">
          <h2 class="title2"><span class="spark"></span> A New Year Wish</h2>
          <p class="para">
            May your days feel lighter, your plans feel possible, and your hard work finally meet its reward.
            Keep the people you love close, keep your curiosity even closer, and don‚Äôt forget that small steps become
            stunning journeys. This year, choose growth, choose peace, choose you. And Happy New Year!!!!
          </p>

          <div class="quote">
            <span>
              ‚ÄúTonight be happy with your loving families i means just drunkkk and be happy your to start a new year with a fresh start.‚Äù
            </span>
          </div>
        </div>
      </aside>
    </div>
  </div>

  <div class="toast" id="toast">üéâ Happy New Year Thwe Thwe! üéâ</div>

  <script>
  // ===============================
  // Countdown (to next Jan 1, local time)
  // ===============================
  const pad2 = n => String(n).padStart(2, "0");

  const el = {
    d: document.getElementById("d"),
    h: document.getElementById("h"),
    m: document.getElementById("m"),
    s: document.getElementById("s"),
    statusText: document.getElementById("statusText"),
    timeText: document.getElementById("timeText"),
    targetText: document.getElementById("targetText"),
    toast: document.getElementById("toast"),
    headline: document.getElementById("headline"),
    hero: document.getElementById("hero"),
    butterfly: document.getElementById("butterfly")
  };

  function nextNewYearDate() {
    const now = new Date();
    return new Date(now.getFullYear() + 1, 0, 1, 0, 0, 0, 0);
  }

  let target = nextNewYearDate();
  el.targetText.textContent = `Target: ${target.toLocaleString(undefined, { dateStyle: "medium", timeStyle: "short" })}`;
  let celebrated = false;

  function tickCountdown(){
    const now = new Date();
    el.timeText.textContent = `Local time: ${now.toLocaleString(undefined, { dateStyle: "medium", timeStyle: "medium" })}`;
    let diff = target - now;

    if (diff <= 0){
      el.d.textContent = el.h.textContent = el.m.textContent = el.s.textContent = "00";
      el.statusText.textContent = "It‚Äôs New Year time ‚Äî celebrate!";
      if (!celebrated){
        celebrated = true;
        newYearSequence();
      }
      return;
    }

    const sec = Math.floor(diff / 1000);
    const days = Math.floor(sec / 86400);
    const hours = Math.floor((sec % 86400) / 3600);
    const mins = Math.floor((sec % 3600) / 60);
    const secs = sec % 60;

    el.d.textContent = pad2(days);
    el.h.textContent = pad2(hours);
    el.m.textContent = pad2(mins);
    el.s.textContent = pad2(secs);

    if (days === 0 && hours === 0 && mins < 1) el.statusText.textContent = "Almost there‚Ä¶ hold your wish ‚ú®";
    else if (days === 0 && hours < 2) el.statusText.textContent = "The final hours‚Ä¶";
    else el.statusText.textContent = "Counting down to the New Year‚Ä¶";
  }

  // ===============================
  // Fireworks Engine (OPTIMIZED)
  // ===============================
  const canvas = document.getElementById("fx");
  const ctx = canvas.getContext("2d", { alpha: true });

  // --- Quality controls (auto-adjust) ---
  const Quality = {
    dprCap: 1.35,            // IMPORTANT: keep <= 1.5 for low lag
    maxRockets: 10,
    maxParticles: 1400,       // hard cap
    particlePerExplosion: 60, // base amount
    ambientChance: 0.022,     // lower = less work
    trailAlpha: 0.18,         // higher clears more (less trails, less overdraw)
    useGlow: false            // big win: no expensive shadowBlur
  };

  let W = 0, H = 0, DPR = 1;
  function resize(){
    DPR = Math.min(Quality.dprCap, window.devicePixelRatio || 1);
    canvas.width = Math.floor(window.innerWidth * DPR);
    canvas.height = Math.floor(window.innerHeight * DPR);
    canvas.style.width = window.innerWidth + "px";
    canvas.style.height = window.innerHeight + "px";
    ctx.setTransform(DPR,0,0,DPR,0,0);
    W = window.innerWidth;
    H = window.innerHeight;
  }
  window.addEventListener("resize", resize);
  resize();

  const rand = (a,b)=> a + Math.random()*(b-a);
  const clamp = (v,a,b)=> Math.max(a, Math.min(b, v));

  const particles = [];
  const rockets = [];

  let fxEnabled = true;
  let ambient = true;

  function colorPick(){
    const palette = [
      [255,79,216],
      [102,240,255],
      [255,209,102],
      [180,255,140],
      [160,160,255]
    ];
    return palette[(Math.random()*palette.length)|0];
  }

  function spawnRocket(x){
    if (!fxEnabled) return;
    if (rockets.length >= Quality.maxRockets) return;
    const [r,g,b] = colorPick();
    rockets.push({
      x, y: H + 10,
      vx: rand(-0.6,0.6),
      vy: rand(-7.6,-10.4),
      ay: 0.12,
      life: 0,
      explodeAt: rand(0.55, 0.85), // seconds
      rgb: {r,g,b},
      size: 2.4
    });
  }

  function explode(x, y, rgb, power=1){
    // adaptive particle count
    const base = Quality.particlePerExplosion;
    const count = Math.floor(base * power);

    // HARD CAP
    if (particles.length + count > Quality.maxParticles) return;

    for (let i=0;i<count;i++){
      const ang = Math.random() * Math.PI * 2;
      const spd = rand(1.2, 4.8) * power;

      particles.push({
        x, y,
        vx: Math.cos(ang) * spd,
        vy: Math.sin(ang) * spd,
        drag: rand(0.985, 0.992),
        grav: rand(0.04, 0.085),
        life: 0,
        ttl: rand(0.85, 1.45), // seconds
        r: rgb.r, g: rgb.g, b: rgb.b,
        size: rand(1.0, 2.0) * power
      });
    }
  }

  // FPS monitor -> auto lower load
  let lastFpsTime = performance.now();
  let frames = 0;
  let fps = 60;

  function autoTune(){
    frames++;
    const now = performance.now();
    if (now - lastFpsTime >= 700){
      fps = Math.round((frames * 1000) / (now - lastFpsTime));
      frames = 0;
      lastFpsTime = now;

      // If FPS drops, reduce ambient and particles
      if (fps < 45){
        Quality.ambientChance = 0.012;
        Quality.particlePerExplosion = 44;
        Quality.maxParticles = 1000;
        Quality.trailAlpha = 0.24;
      } else if (fps < 55){
        Quality.ambientChance = 0.016;
        Quality.particlePerExplosion = 52;
        Quality.maxParticles = 1200;
        Quality.trailAlpha = 0.21;
      } else {
        Quality.ambientChance = 0.022;
        Quality.particlePerExplosion = 60;
        Quality.maxParticles = 1400;
        Quality.trailAlpha = 0.18;
      }
    }
  }

  // initial clear
  ctx.fillStyle = "rgba(2,2,8,1)";
  ctx.fillRect(0,0,W,H);

  let lastT = performance.now();
  function step(t){
    requestAnimationFrame(step);
    autoTune();

    const dt = Math.min(0.033, (t - lastT) / 1000); // cap dt
    lastT = t;

    // Fade for trails (cheap)
    ctx.fillStyle = `rgba(2, 2, 8, ${Quality.trailAlpha})`;
    ctx.fillRect(0,0,W,H);

    if (fxEnabled && ambient && Math.random() < Quality.ambientChance){
      spawnRocket(rand(80, W-80));
    }

    // Rockets
    for (let i=rockets.length-1;i>=0;i--){
      const r = rockets[i];
      r.life += dt;

      r.vy += r.ay;
      r.x += r.vx * (dt * 60);
      r.y += r.vy * (dt * 60);

      // Rocket dot (no shadow blur)
      ctx.globalCompositeOperation = "lighter";
      ctx.fillStyle = `rgba(${r.rgb.r},${r.rgb.g},${r.rgb.b},0.95)`;
      ctx.beginPath();
      ctx.arc(r.x, r.y, r.size, 0, Math.PI*2);
      ctx.fill();

      if (r.life >= r.explodeAt || r.vy > -1.1){
        explode(r.x, r.y, r.rgb, 1);
        rockets.splice(i,1);
      }
    }

    // Particles (no shadowBlur -> big performance win)
    ctx.globalCompositeOperation = "lighter";
    for (let i=particles.length-1;i>=0;i--){
      const p = particles[i];
      p.life += dt;

      p.vx *= p.drag;
      p.vy = p.vy * p.drag + p.grav;
      p.x += p.vx * (dt * 60);
      p.y += p.vy * (dt * 60);

      const alpha = clamp(1 - (p.life / p.ttl), 0, 1);
      if (alpha <= 0 || p.y > H + 40){
        particles.splice(i,1);
        continue;
      }

      // Slightly brighter without shadow
      ctx.fillStyle = `rgba(${p.r},${p.g},${p.b},${alpha})`;
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.size, 0, Math.PI*2);
      ctx.fill();
    }

    ctx.globalCompositeOperation = "source-over";
  }
  requestAnimationFrame(step);

  // Click/tap fireworks (lighter)
  function pointerFire(e){
    if (!fxEnabled) return;
    const x = (e.touches ? e.touches[0].clientX : e.clientX);
    // Spawn only a couple rockets, not many
    spawnRocket(x);
    if (Math.random() < 0.35){
      const rgb = {r:255,g:209,b:102};
      explode(x, rand(H*0.25, H*0.65), rgb, 0.95);
    }
  }
  window.addEventListener("click", pointerFire, { passive:true });
  window.addEventListener("touchstart", pointerFire, { passive:true });

  // Buttons
  document.getElementById("burstBtn").addEventListener("click", ()=>{
    if (!fxEnabled) return;
    // Controlled burst (no spam)
    const burstCount = 5;
    for (let i=0;i<burstCount;i++){
      setTimeout(()=> spawnRocket(rand(120, W-120)), i*90);
    }
  });

  document.getElementById("toggleFxBtn").addEventListener("click", ()=>{
    fxEnabled = !fxEnabled;
    ambient = fxEnabled;
    document.getElementById("toggleFxBtn").textContent = fxEnabled ? "ü™Ñ Toggle Fireworks" : "ü™Ñ Fireworks Off";
    if (!fxEnabled){
      rockets.length = 0;
      particles.length = 0;
      // Clear canvas quickly
      ctx.fillStyle = "rgba(2,2,8,1)";
      ctx.fillRect(0,0,W,H);
    }
  });

  // ===============================
  // New Year sequence (optimized)
  // ===============================
  function showToast(msg){
    el.toast.textContent = msg;
    el.toast.classList.add("show");
    setTimeout(()=> el.toast.classList.remove("show"), 4500);
  }

  function newYearSequence(){
    el.headline.style.filter = "drop-shadow(0 0 18px rgba(255,79,216,.35)) drop-shadow(0 0 18px rgba(102,240,255,.28))";
    showToast("üéâ Happy New Year! May your wishes come true ‚ú®");

    fxEnabled = true;
    ambient = true;

    // short show, controlled load
    let shots = 0;
    const maxShots = 18;
    const timer = setInterval(()=>{
      if (!fxEnabled) { clearInterval(timer); return; }
      spawnRocket(rand(90, W-90));
      if (++shots >= maxShots) {
        clearInterval(timer);
        confettiBurst(130);
      }
    }, 140);
  }

  // Confetti (DOM) ‚Äî keep moderate
  function confettiBurst(count=120){
    const wrap = document.createElement("div");
    wrap.style.position="fixed";
    wrap.style.inset="0";
    wrap.style.zIndex="4";
    wrap.style.pointerEvents="none";
    document.body.appendChild(wrap);

    for (let i=0;i<count;i++){
      const p = document.createElement("div");
      const size = rand(6, 12);
      p.style.position="absolute";
      p.style.left = rand(10, 90) + "vw";
      p.style.top = "-10vh";
      p.style.width = size + "px";
      p.style.height = rand(10, 18) + "px";
      p.style.borderRadius = rand(2, 8) + "px";

      const c = colorPick();
      p.style.background = `rgba(${c[0]},${c[1]},${c[2]},.9)`;

      const fall = rand(1200, 2200);
      const drift = rand(-120, 120);
      const rot = rand(-240, 240);

      p.animate([
        { transform:`translate(0,0) rotate(0deg)`, opacity: 1 },
        { transform:`translate(${drift}px, 120vh) rotate(${rot}deg)`, opacity: 0.9 }
      ], {
        duration: fall,
        easing: "cubic-bezier(.12,.62,.15,1)",
        fill: "forwards"
      });

      wrap.appendChild(p);
    }

    setTimeout(()=> wrap.remove(), 2600);
  }

  let mx = 0, my = 0;
  window.addEventListener("mousemove", (e)=>{
    mx = (e.clientX / window.innerWidth) * 2 - 1;
    my = (e.clientY / window.innerHeight) * 2 - 1;
  }, { passive:true });

  function parallax(){
    const rx = clamp(my * -7, -9, 9);
    const ry = clamp(mx *  9, -10, 10);
    document.documentElement.style.setProperty("--rx", rx + "deg");
    document.documentElement.style.setProperty("--ry", ry + "deg");

    const tiltX = clamp(my * 2.2, -2.2, 2.2);
    const tiltY = clamp(mx * 3.2, -3.2, 3.2);
    el.hero.style.transform = `perspective(1000px) rotateX(${tiltX}deg) rotateY(${tiltY}deg)`;
    el.butterfly.style.transform = `translateY(${Math.sin(Date.now()/700)*3}px) rotate(${mx*1.5}deg)`;
    requestAnimationFrame(parallax);
  }
  parallax();

  // run countdown
  tickCountdown();
  setInterval(tickCountdown, 250);

  // Optional: if already new year
  if ((target - new Date()) <= 0 && !celebrated){
    celebrated = true;
    newYearSequence();
  }
</script>

</body>
</html>
